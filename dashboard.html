<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minha área - Nexus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" />
</head>

<body>
  <!-- NAV -->
  <header class="topbar">
    <a href="index.html" class="brand">
      <img src="logo.png" class="brand-logo" />
      <span class="brand-name">Nexus</span>
    </a>

    <button class="nav-toggle" id="navToggle">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <nav class="nav" id="navMenu">
      <a href="index.html" class="nav-link">Início</a>
      <a href="dashboard.html" class="nav-link active">Minha área</a>
      <a href="assinatura.html" class="nav-link">Assinatura</a>
      <a href="login.html" class="nav-link">Entrar</a>
    </nav>
  </header>

  <main class="page">

    <!-- CABEÇALHO DO DASHBOARD -->
    <section class="section section-dashboard-hero">
      <div class="section-header">
        <h1>Minha área Nexus</h1>
        <p>
          Bem-vindo! Aqui você acompanha o seu plano, acessa atalhos rápidos
          e testa a busca demo do Nexus.
        </p>
      </div>
    </section>

    <!-- RESUMO DO PLANO + ATALHOS -->
    <section class="section section-dashboard-summary">
      <div class="section-header">
        <h2>Visão geral da sua conta</h2>
        <p>Veja seu plano atual e alguns atalhos para se movimentar dentro do Nexus.</p>
      </div>

      <div class="plans-grid">
        <article class="plan-card dashboard-card">
          <h2>Seu plano atual</h2>
          <p class="plan-price">Gratuito <span>/ demo</span></p>

          <ul class="plan-list">
            <li>Acesso às buscas básicas</li>
            <li>Testes da busca demo Premium</li>
            <li>Sem necessidade de cartão agora</li>
          </ul>

          <a href="assinatura.html" class="btn-outline full">
            Ver planos Premium
          </a>
        </article>

        <article class="plan-card dashboard-card">
          <h2>Atalhos rápidos</h2>
          <ul class="plan-list">
            <li><a href="index.html">Ir para página inicial</a></li>
            <li><a href="dashboard.html">Atualizar minha área</a></li>
            <li><a href="assinatura.html">Gerenciar assinatura</a></li>
          </ul>
        </article>
      </div>
    </section>

    <!-- BUSCA DEMO -->
    <section class="section section-dashboard-search">
      <div class="section-header">
        <h2>Busca demo conectada ao backend</h2>
        <p>Digite um produto e veja como a comparação funciona em modo demonstração.</p>
      </div>

      <div class="premium-search">
        <form id="premiumSearchForm" class="search-form">
          <input
            type="text"
            id="premiumQuery"
            class="input-search"
            placeholder="Ex.: notebook gamer, teclado mecânico, headset..."
            required
          />
          <button type="submit" class="btn-outline full">
            Buscar ofertas demo
          </button>
        </form>

        <div id="premiumSearchResults" class="search-results"></div>
      </div>
    </section>

    <!-- ÁREA DE CARRINHO -->
    <section class="section section-dashboard-cart">
      <div class="section-header">
        <h2>Seu carrinho Nexus</h2>
        <p>
          Uma visão inicial de como o carrinho vai funcionar para todos os planos.
          O objetivo é organizar suas ofertas, sem criar diferença de tratamento.
        </p>
      </div>

      <div class="plans-grid carts-grid">
       <!-- Carrinho do plano gratuito -->
<article class="plan-card cart-card">
  <h3>Carrinho do plano gratuito</h3>
  <p class="plan-price">Gratuito <span>/ demo</span></p>

  <ul class="plan-list">
    <li>Salvar algumas ofertas favoritas</li>
    <li>Organizar itens que você está pensando em comprar</li>
    <li>Visual simples e direto, sem exageros</li>
  </ul>

  <p class="cart-note">
    Itens salvos neste carrinho são só de demonstração por enquanto.
  </p>

  <!-- ITENS DO CARRINHO GRATUITO (DINÂMICO) -->
  <ul id="cartFreeList" class="cart-items"></ul>
</article>

<!-- Carrinho do plano Premium -->
<article class="plan-card cart-card">
  <h3>Carrinho do plano Premium</h3>
  <p class="plan-price">Premium <span>/ futuro</span></p>

  <ul class="plan-list">
    <li>Salvar quantas ofertas quiser</li>
    <li>Ver histórico de alterações de preço</li>
    <li>Organizar por loja, categoria e prioridade</li>
  </ul>

  <p class="cart-note">
    A ideia do Premium é trazer mais controle, não mais “status”.
    O foco é facilitar sua vida, não criar diferença de tratamento.
  </p>

  <!-- ITENS DO CARRINHO PREMIUM (por enquanto vamos usar igual ao gratuito) -->
  <ul id="cartPremiumList" class="cart-items"></ul>

  <a href="assinatura.html" class="btn-outline full">
    Conhecer planos Premium
  </a>
</article>
      </div>
    </section>

    <!-- INFO DEMO -->
    <section class="section section-dashboard-info">
      <div class="section-header">
        <h2>Modo demonstração</h2>
        <p>
          Esta área ainda está em modo <strong>demo</strong>. Aos poucos,
          ela vai ganhar mais recursos para acompanhar sua jornada dentro do Nexus.
        </p>
      </div>

      <ul>
        <li>Histórico real de buscas</li>
        <li>Ofertas salvas / favoritos</li>
        <li>Status da assinatura e pagamentos</li>
      </ul>
    </section>

  </main>

  <footer class="footer">
    <p>Nexus © 2025 – Comparador Gamer & Tech com IA.</p>
  </footer>

  <script>
    // MENU MOBILE
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");

    if (navToggle && navMenu) {
      navToggle.addEventListener("click", () => {
        navMenu.classList.toggle("nav-open");
      });
    }

    // BUSCA PREMIUM → chama backend /api/search/demo
    const premiumForm = document.getElementById("premiumSearchForm");
    const premiumInput = document.getElementById("premiumQuery");
    const premiumResults = document.getElementById("premiumSearchResults");

    async function handlePremiumSearch(event) {
      event.preventDefault();

      if (!premiumInput || !premiumResults) return;

      const termo = premiumInput.value.trim();
      if (!termo) return;

      // estado de carregando
      premiumResults.innerHTML = "<p>Buscando ofertas demo...</p>";

      try {
        const response = await fetch("http://localhost:3000/api/search/demo", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ query: termo }),
        });

        if (!response.ok) {
          throw new Error("Erro ao chamar a API");
        }

        const data = await response.json();

        if (!data.ok || !Array.isArray(data.results) || data.results.length === 0) {
          premiumResults.innerHTML =
            "<p>Nenhum resultado encontrado na demo para esse termo.</p>";
          return;
        }

        const list = document.createElement("ul");
list.className = "results-list";

data.results.forEach((item) => {
  const li = document.createElement("li");
  const priceNumber =
    typeof item.price === "number" ? item.price : null;
  const priceText =
    priceNumber !== null
      ? "R$ " + priceNumber.toFixed(2).replace(".", ",")
      : (item.price || "Preço não informado");

  // conteúdo principal
  const infoDiv = document.createElement("div");
  infoDiv.innerHTML = `
    <strong>${item.title}</strong><br />
    <span>${item.store}</span> — <span>${priceText}</span>
  `;

  // botão de adicionar ao carrinho
  const btn = document.createElement("button");
  btn.className = "btn-outline";
  btn.textContent = "Adicionar ao carrinho (demo)";

  btn.addEventListener("click", () => {
    addToFreeCart({
      title: item.title,
      store: item.store,
      price: priceNumber,
    });
  });

  li.appendChild(infoDiv);
  li.appendChild(btn);
  list.appendChild(li);
});

premiumResults.innerHTML = "";
premiumResults.appendChild(list);

        premiumResults.innerHTML = "";
        premiumResults.appendChild(list);
      } catch (err) {
        console.error(err);
        premiumResults.innerHTML =
          "<p>Ocorreu um erro ao buscar as ofertas demo. Verifique se o servidor do backend está rodando.</p>";
      }
    }

    if (premiumForm) {
      premiumForm.addEventListener("submit", handlePremiumSearch);
    }
    // ============== CARRINHO (DEMO) ==============

const cartFreeList = document.getElementById("cartFreeList");
// por enquanto não vamos usar o premiumList, mas deixamos pronto
const cartPremiumList = document.getElementById("cartPremiumList");

// lê carrinho salvo no localStorage (se existir)
function loadCartFromStorage() {
  try {
    const raw = localStorage.getItem("nexus_cart_free");
    if (!raw || !cartFreeList) return;

    const items = JSON.parse(raw);
    if (!Array.isArray(items)) return;

    cartFreeList.innerHTML = "";
    items.forEach((item) => {
      const li = document.createElement("li");
      const priceText =
        typeof item.price === "number"
          ? "R$ " + item.price.toFixed(2).replace(".", ",")
          : (item.price || "Preço não informado");

      li.textContent = `${item.title} – ${item.store} (${priceText})`;
      cartFreeList.appendChild(li);
    });
  } catch (e) {
    console.error("Erro ao carregar carrinho:", e);
  }
}

function addToFreeCart(item) {
  try {
    const raw = localStorage.getItem("nexus_cart_free");
    const current = raw ? JSON.parse(raw) : [];

    const updated = Array.isArray(current) ? current : [];
    updated.push({
      title: item.title || "Produto sem nome",
      store: item.store || "Loja não informada",
      price: typeof item.price === "number" ? item.price : null,
    });

    localStorage.setItem("nexus_cart_free", JSON.stringify(updated));
    loadCartFromStorage();
    alert("Item adicionado ao carrinho (modo demonstração).");
  } catch (e) {
    console.error("Erro ao adicionar ao carrinho:", e);
  }
}

// carrega carrinho ao abrir o dashboard
loadCartFromStorage();
  </script>
</body>
</html>
