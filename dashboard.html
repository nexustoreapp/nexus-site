<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minha área - Nexus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" />
</head>

<body>
  <!-- NAV -->
  <header class="topbar">
    <a href="index.html" class="brand">
      <img src="logo.png" class="brand-logo" />
      <span class="brand-name">Nexus</span>
    </a>

    <button class="nav-toggle" id="navToggle">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <nav class="nav" id="navMenu">
      <a href="index.html" class="nav-link">Início</a>
      <a href="dashboard.html" class="nav-link active">Minha área</a>
      <a href="assinatura.html" class="nav-link">Assinatura</a>
      <a href="login.html" class="nav-link">Entrar</a>
    </nav>
  </header>

  <main class="page">

    <h1>Minha área Nexus</h1>
    <p>Bem-vindo! Aqui você vê seu plano, atalhos e testes da busca demo do Nexus.</p>

    <!-- RESUMO DO PLANO + ATALHOS (reaproveitando estilo dos cards de planos) -->
    <section class="plans-grid">
      <article class="plan-card dashboard-card">
        <h2>Seu plano atual</h2>
        <p class="plan-price">Gratuito <span>/ demo</span></p>

        <ul class="plan-list">
          <li>Acesso às buscas básicas</li>
          <li>Testes da busca demo Premium</li>
          <li>Sem necessidade de cartão agora</li>
        </ul>

        <a href="assinatura.html" class="btn-outline full">
          Ver planos Premium
        </a>
      </article>

      <article class="plan-card dashboard-card">
        <h2>Atalhos rápidos</h2>
        <ul class="plan-list">
          <li><a href="index.html">Ir para página inicial</a></li>
          <li><a href="dashboard.html">Atualizar minha área</a></li>
          <li><a href="assinatura.html">Gerenciar assinatura</a></li>
        </ul>
      </article>
    </section>

    <!-- BUSCA DEMO (a mesma que a gente já integrou) -->
    <section class="premium-search">
      <h2>Teste a busca demo</h2>
      <p>Digite um produto para ver como a comparação funciona (os dados ainda são fictícios).</p>

      <form id="premiumSearchForm" class="search-form">
        <input
          type="text"
          id="premiumQuery"
          class="input-search"
          placeholder="Ex.: notebook gamer, teclado mecânico, headset..."
          required
        />
        <button type="submit" class="btn-outline full">
          Buscar ofertas demo
        </button>
      </form>

      <div id="premiumSearchResults" class="search-results"></div>
    </section>

    <!-- ÁREA DE CARRINHO PARA GRATUITO E PREMIUM (sem desigualdade social) -->
    <section class="cart-section">
      <h2>Seu carrinho Nexus</h2>
      <p>
        Esta é uma visão geral de como o carrinho vai funcionar para todos os planos.
        Mesmo no plano gratuito, você vai conseguir organizar suas ofertas — o Premium só adiciona algumas facilidades a mais.
      </p>

      <div class="plans-grid carts-grid">
        <!-- Carrinho do plano gratuito -->
        <article class="plan-card cart-card">
          <h3>Carrinho do plano gratuito</h3>
          <p class="plan-price">Gratuito <span>/ demo</span></p>

          <ul class="plan-list">
            <li>Salvar algumas ofertas favoritas</li>
            <li>Organizar itens que você está pensando em comprar</li>
            <li>Visual simples e direto, sem exageros</li>
          </ul>

          <p class="cart-note">
            Em breve, você poderá adicionar itens do resultado da busca direto aqui.
          </p>
        </article>

        <!-- Carrinho do plano Premium -->
        <article class="plan-card cart-card">
          <h3>Carrinho do plano Premium</h3>
          <p class="plan-price">Premium <span>/ futuro</span></p>

          <ul class="plan-list">
            <li>Salvar quantas ofertas quiser</li>
            <li>Ver histórico de alterações de preço</li>
            <li>Organizar por loja, categoria e prioridade</li>
          </ul>

          <p class="cart-note">
            A ideia é que o Premium traga mais controle, não mais “status”. O objetivo é facilitar sua vida, não criar diferença de tratamento.
          </p>

          <a href="assinatura.html" class="btn-outline full">
            Conhecer planos Premium
          </a>
        </article>
      </div>
    </section>

    <!-- INFO DEMO -->
    <section class="info-section">
      <h2>Modo demonstração</h2>
      <p>
        Esta área ainda está em modo <strong>demo</strong>. Aos poucos, ela vai ganhar:
      </p>
      <ul>
        <li>Histórico real de buscas</li>
        <li>Ofertas salvas / favoritos</li>
        <li>Status da assinatura e pagamentos</li>
      </ul>
    </section>

  </main>

  <footer class="footer">
    <p>Nexus © 2025 – Comparador Gamer & Tech com IA.</p>
  </footer>

  <script>
    // MENU MOBILE
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");

    if (navToggle && navMenu) {
      navToggle.addEventListener("click", () => {
        navMenu.classList.toggle("nav-open");
      });
    }

    // BUSCA PREMIUM → chama backend /api/search/demo
    const premiumForm = document.getElementById("premiumSearchForm");
    const premiumInput = document.getElementById("premiumQuery");
    const premiumResults = document.getElementById("premiumSearchResults");

    async function handlePremiumSearch(event) {
      event.preventDefault();

      if (!premiumInput || !premiumResults) return;

      const termo = premiumInput.value.trim();
      if (!termo) return;

      // estado de carregando
      premiumResults.innerHTML = "<p>Buscando ofertas demo...</p>";

      try {
        const response = await fetch("http://localhost:3000/api/search/demo", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ query: termo }),
        });

        if (!response.ok) {
          throw new Error("Erro ao chamar a API");
        }

        const data = await response.json();

        if (!data.ok || !Array.isArray(data.results) || data.results.length === 0) {
          premiumResults.innerHTML =
            "<p>Nenhum resultado encontrado na demo para esse termo.</p>";
          return;
        }

        const list = document.createElement("ul");
        list.className = "results-list";

        data.results.forEach((item) => {
          const li = document.createElement("li");
          const price =
            typeof item.price === "number"
              ? "R$ " + item.price.toFixed(2).replace(".", ",")
              : item.price;

          li.innerHTML = `
            <strong>${item.title}</strong><br />
            <span>${item.store}</span> — <span>${price}</span>
          `;
          list.appendChild(li);
        });

        premiumResults.innerHTML = "";
        premiumResults.appendChild(list);
      } catch (err) {
        console.error(err);
        premiumResults.innerHTML =
          "<p>Ocorreu um erro ao buscar as ofertas demo. Verifique se o servidor do backend está rodando.</p>";
      }
    }

    if (premiumForm) {
      premiumForm.addEventListener("submit", handlePremiumSearch);
    }
  </script>
</body>
</html>
