<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Teste Auth Nexus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { background:#0f0f0f; color:#eaeaea; font-family: Arial, sans-serif; padding:16px; }
    h2 { margin-bottom: 12px; }
    input, button { width:100%; padding:12px; margin:8px 0; font-size:16px; }
    button { background:#4f46e5; color:#fff; border:none; border-radius:6px; }
    pre { background:#000; color:#7CFC00; padding:12px; border-radius:6px; min-height:120px; white-space:pre-wrap; }
  </style>
</head>
<body>

<h2>Teste Auth Nexus</h2>

<input id="email" placeholder="Email" value="teste@nexus.com" />
<input id="password" placeholder="Senha" type="password" value="123456" />
<input id="cpf" placeholder="CPF (só números)" value="12345678909" />

<button id="btn-register">Registrar</button>
<button id="btn-verify">Verificar OTP</button>
<button id="btn-login">Login</button>

<pre id="out">Pronto.</pre>

<script>
const API = "https://nexus-site-oufm.onrender.com/api/auth";
const out = document.getElementById("out");

function show(v){
  out.textContent = typeof v === "string" ? v : JSON.stringify(v, null, 2);
}

async function post(url, body){
  const r = await fetch(url, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });
  const t = await r.text();
  try { return JSON.parse(t); }
  catch { return { ok:false, error:"NOT_JSON", raw:t.slice(0,200) }; }
}

document.getElementById("btn-register").onclick = async () => {
  show("Registrando...");
  try{
    const data = await post(API + "/register", {
      email: document.getElementById("email").value.trim(),
      password: document.getElementById("password").value,
      cpf: document.getElementById("cpf").value.replace(/\D/g,"")
    });
    show(data);
  }catch(e){
    show("ERRO REGISTER: " + e.message);
  }
};

document.getElementById("btn-verify").onclick = async () => {
  const otp = prompt("Digite o OTP:");
  if(!otp) return;
  show("Verificando OTP...");
  try{
    const data = await post(API + "/verify-otp", {
      email: document.getElementById("email").value.trim(),
      otp: otp.trim()
    });
    show(data);
  }catch(e){
    show("ERRO OTP: " + e.message);
  }
};

document.getElementById("btn-login").onclick = async () => {
  show("Logando...");
  try{
    const data = await post(API + "/login", {
      email: document.getElementById("email").value.trim(),
      password: document.getElementById("password").value
    });
    show(data);
  }catch(e){
    show("ERRO LOGIN: " + e.message);
  }
};
</script>

</body>
</html>